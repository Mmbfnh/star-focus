<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¬Ù… Ø§Ù„ØªØ±ÙƒÙŠØ² - Ù…Ù†ØµØ© ØªØ¹Ù„ÙŠÙ…ÙŠØ© Ù…ØªÙƒØ§Ù…Ù„Ø©</title>
    
    <!-- Ø§Ù„Ù…ÙƒØªØ¨Ø§Øª Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠØ© -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>

    <style>
        /* Ø£Ù†Ù…Ø§Ø· Tailwind Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© */
        .min-h-screen { min-height: 100vh; }
        .max-w-7xl { max-width: 80rem; }
        .mx-auto { margin-left: auto; margin-right: auto; }
        .p-4 { padding: 1rem; }
        .flex { display: flex; }
        .justify-between { justify-content: space-between; }
        .items-center { align-items: center; }
        .text-center { text-align: center; }
        .text-white { color: white; }
        .text-4xl { font-size: 2.25rem; }
        .font-bold { font-weight: 700; }
        .bg-gradient-to-br { background-image: linear-gradient(to bottom right, var(--tw-gradient-stops)); }
        .from-blue-50 { --tw-gradient-from: #eff6ff; }
        .to-purple-50 { --tw-gradient-to: #faf5ff; }
        .rounded-2xl { border-radius: 1rem; }
        .grid { display: grid; }
        .gap-4 { gap: 1rem; }
        .grid-cols-1 { grid-template-columns: repeat(1, minmax(0, 1fr)); }
        .w-full { width: 100%; }
        .space-y-6 > * + * { margin-top: 1.5rem; }
        .space-y-4 > * + * { margin-top: 1rem; }
        .space-y-3 > * + * { margin-top: 0.75rem; }
        .space-y-2 > * + * { margin-top: 0.5rem; }
        .mb-8 { margin-bottom: 2rem; }
        .mb-6 { margin-bottom: 1.5rem; }
        .mb-4 { margin-bottom: 1rem; }
        .mb-3 { margin-bottom: 0.75rem; }
        .mb-2 { margin-bottom: 0.5rem; }
        .mt-4 { margin-top: 1rem; }
        .mt-2 { margin-top: 0.5rem; }
        .pt-4 { padding-top: 1rem; }
        .pb-2 { padding-bottom: 0.5rem; }
        .p-6 { padding: 1.5rem; }
        .p-3 { padding: 0.75rem; }
        .p-2 { padding: 0.5rem; }
        .px-4 { padding-left: 1rem; padding-right: 1rem; }
        .py-2 { padding-top: 0.5rem; padding-bottom: 0.5rem; }
        .py-8 { padding-top: 2rem; padding-bottom: 2rem; }
        .py-4 { padding-top: 1rem; padding-bottom: 1rem; }
        .py-12 { padding-top: 3rem; padding-bottom: 3rem; }
        .shadow-xl { box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04); }
        .shadow-lg { box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); }
        .overflow-x-auto { overflow-x: auto; }
        .overflow-y-auto { overflow-y: auto; }
        .whitespace-nowrap { white-space: nowrap; }
        .flex-shrink-0 { flex-shrink: 0; }
        .flex-1 { flex: 1 1 0%; }
        .min-w-32 { min-width: 8rem; }
        .text-lg { font-size: 1.125rem; }
        .text-xl { font-size: 1.25rem; }
        .text-2xl { font-size: 1.5rem; }
        .text-3xl { font-size: 1.875rem; }
        .text-sm { font-size: 0.875rem; }
        .opacity-80 { opacity: 0.8; }
        .opacity-70 { opacity: 0.7; }
        .opacity-60 { opacity: 0.6; }
        .transition-all { transition: all 0.3s ease; }
        .transition-colors { transition: colors 0.3s ease; }
        .duration-300 { transition-duration: 300ms; }
        .hover\:bg-opacity-30:hover { background-opacity: 0.3; }
        .hover\:bg-opacity-20:hover { background-opacity: 0.2; }
        .hover\:bg-white:hover { background-color: white; }
        .hover\:bg-green-600:hover { background-color: #059669; }
        .hover\:bg-blue-600:hover { background-color: #2563eb; }
        .hover\:bg-gray-600:hover { background-color: #4b5563; }
        .hover\:bg-red-600:hover { background-color: #dc2626; }
        .hover\:bg-purple-600:hover { background-color: #7c3aed; }
        .hover\:text-red-300:hover { color: #fca5a5; }
        .hover\:opacity-70:hover { opacity: 0.7; }
        .cursor-pointer { cursor: pointer; }
        .cursor-not-allowed { cursor: not-allowed; }
        .hidden { display: none; }
        .fixed { position: fixed; }
        .inset-0 { top: 0; right: 0; bottom: 0; left: 0; }
        .top-4 { top: 1rem; }
        .left-4 { left: 1rem; }
        .right-4 { right: 1rem; }
        .bottom-4 { bottom: 1rem; }
        .z-50 { z-index: 50; }
        .z-40 { z-index: 40; }
        .border { border-width: 1px; }
        .border-l-4 { border-left-width: 4px; }
        .rounded-lg { border-radius: 0.5rem; }
        .rounded-xl { border-radius: 0.75rem; }
        .truncate { overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .placeholder-gray-300::placeholder { color: #d1d5db; }

        /* Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ø´Ø¨ÙƒØ© Ù„Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„Ù…ØªÙˆØ³Ø·Ø© */
        @media (min-width: 768px) {
            .md\:grid-cols-2 { grid-template-columns: repeat(2, minmax(0, 1fr)); }
            .md\:grid-cols-3 { grid-template-columns: repeat(3, minmax(0, 1fr)); }
            .md\:col-span-2 { grid-column: span 2 / span 2; }
        }

        /* Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ø´Ø¨ÙƒØ© Ù„Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ÙƒØ¨ÙŠØ±Ø© */
        @media (min-width: 1024px) {
            .lg\:grid-cols-3 { grid-template-columns: repeat(3, minmax(0, 1fr)); }
            .lg\:grid-cols-4 { grid-template-columns: repeat(4, minmax(0, 1fr)); }
        }

        /* Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ø£Ù„ÙˆØ§Ù† */
        .bg-green-500 { background-color: #10b981; }
        .bg-blue-500 { background-color: #3b82f6; }
        .bg-gray-500 { background-color: #6b7280; }
        .bg-red-500 { background-color: #ef4444; }
        .bg-purple-500 { background-color: #8b5cf6; }
        .bg-yellow-500 { background-color: #eab308; }
        .bg-orange-500 { background-color: #f59e0b; }
        .bg-green-100 { background-color: #dcfce7; }
        .bg-blue-100 { background-color: #dbeafe; }
        .bg-purple-100 { background-color: #e9d5ff; }
        .bg-yellow-50 { background-color: #fefce8; }
        .bg-gray-100 { background-color: #f3f4f6; }
        .bg-red-100 { background-color: #fee2e2; }
        .bg-white { background-color: white; }
        .bg-black { background-color: black; }
        .bg-opacity-50 { background-opacity: 0.5; }
        .bg-opacity-20 { background-opacity: 0.2; }
        .bg-opacity-10 { background-opacity: 0.1; }

        .text-green-800 { color: #166534; }
        .text-blue-800 { color: #1e40af; }
        .text-purple-800 { color: #6b21a8; }
        .text-yellow-800 { color: #854d0e; }
        .text-yellow-700 { color: #a16207; }
        .text-gray-800 { color: #1f2937; }
        .text-gray-500 { color: #6b7280; }
        .text-green-600 { color: #059669; }
        .text-blue-600 { color: #2563eb; }
        .text-purple-600 { color: #7c3aed; }
        .text-red-400 { color: #f87171; }
        .text-yellow-400 { color: #facc15; }
        .text-green-400 { color: #4ade80; }

        .border-green-500 { border-color: #10b981; }
        .border-red-500 { border-color: #ef4444; }
        .border-yellow-500 { border-color: #eab308; }
        .border-yellow-200 { border-color: #fef08a; }

        /* Ø§Ù„Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ø®Ø§ØµØ© Ø¨Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ */
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --dark-gradient: linear-gradient(135deg, #1e293b, #334155);
            --glass-bg: rgba(255, 255, 255, 0.25);
            --glass-border: 1px solid rgba(255, 255, 255, 0.18);
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--primary-gradient);
            min-height: 100vh;
            transition: all 0.3s ease;
        }

        .glass-effect {
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            border: var(--glass-border);
        }

        .hover-lift {
            transition: all 0.3s ease;
        }

        .hover-lift:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .fade-in { animation: fadeIn 0.5s ease-in-out; }
        .float-animation { animation: float 3s ease-in-out infinite; }

        .dark-mode { background: var(--dark-gradient); color: #f1f5f9; }
        .dark-mode .glass-effect { background: rgba(30, 41, 59, 0.7); }

        .loading-spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #6366f1;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
        }

        .notification-success { background: rgba(34, 197, 94, 0.9); }
        .notification-error { background: rgba(239, 68, 68, 0.9); }
        .notification-info { background: rgba(59, 130, 246, 0.9); }

        .priority-high { background: #ef4444; }
        .priority-medium { background: #f59e0b; }
        .priority-low { background: #10b981; }

        .progress-bar {
            height: 8px;
            border-radius: 4px;
            background: rgba(255, 255, 255, 0.2);
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #10b981, #34d399);
            transition: width 0.3s ease;
        }
        
        .firebase-badge {
            background: linear-gradient(135deg, #ffa000, #ffca28);
            color: #5d4037;
        }

        @media (max-width: 768px) {
            .container-padding {
                padding: 1rem;
            }
        }
    </style>
</head>
<body class="min-h-screen">
    <div id="root"></div>

    <script type="text/babel">
        // ğŸ”¥ Firebase Configuration - Ø§Ø³ØªØ¨Ø¯Ù„ Ù‡Ø°Ù‡ Ø¨Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ© Ù…Ù† Ù…Ø´Ø±ÙˆØ¹Ùƒ
        const FIREBASE_CONFIG = {
            apiKey: "AIzaSyA1b2c3d4e5f6g7h8i9j0-k1l2m3n4o5p6q7",
            authDomain: "your-actual-project.firebaseapp.com",
            projectId: "your-actual-project-id",
            storageBucket: "your-actual-project.appspot.com",
            messagingSenderId: "123456789012",
            appId: "1:123456789012:web:abcdef123456789"
        };

        // Constants
        const DEFAULT_REWARDS = [
            { id: 1, name: "ÙˆØ³Ø§Ù… Ø±Ù‚Ù…ÙŠ", type: "digital", starsRequired: 5, icon: "ğŸ†" },
            { id: 2, name: "ÙˆÙ‚Øª Ù„Ø¹Ø¨Ø© 30 Ø¯Ù‚ÙŠÙ‚Ø©", type: "real", starsRequired: 10, icon: "ğŸ®" },
            { id: 3, name: "Ø®Ø±ÙˆØ¬ Ù„Ù„Ø­Ø¯ÙŠÙ‚Ø©", type: "real", starsRequired: 15, icon: "ğŸŒ³" },
            { id: 4, name: "ÙˆØ¬Ø¨Ø© Ù…ÙØ¶Ù„Ø©", type: "real", starsRequired: 20, icon: "ğŸ•" }
        ];

        const AVATARS = ["ğŸ‘¦", "ğŸ‘§", "ğŸ§‘", "ğŸ‘©", "ğŸ¦¸", "ğŸ¦¹", "ğŸ§™", "ğŸ§š", "ğŸ‘¨â€ğŸš€", "ğŸ‘©â€ğŸš€"];
        const DAYS_OF_WEEK = ["Ø§Ù„Ø³Ø¨Øª", "Ø§Ù„Ø£Ø­Ø¯", "Ø§Ù„Ø¥Ø«Ù†ÙŠÙ†", "Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡", "Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡", "Ø§Ù„Ø®Ù…ÙŠØ³", "Ø§Ù„Ø¬Ù…Ø¹Ø©"];
        const FOCUS_LEVELS = ['Ù…Ù†Ø®ÙØ¶', 'Ù…ØªÙˆØ³Ø·', 'Ù…Ø±ØªÙØ¹'];
        const PRIORITY_LEVELS = ['Ù…Ù†Ø®ÙØ¶', 'Ù…ØªÙˆØ³Ø·', 'Ù…Ø±ØªÙØ¹'];

        // Utility Functions
        const utils = {
            calculateAge(birthDate) {
                if (!birthDate) return 0;
                const today = new Date();
                const birth = new Date(birthDate);
                let age = today.getFullYear() - birth.getFullYear();
                const monthDiff = today.getMonth() - birth.getMonth();
                if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birth.getDate())) {
                    age--;
                }
                return age;
            },

            getCurrentDay() {
                const days = ["Ø§Ù„Ø£Ø­Ø¯", "Ø§Ù„Ø¥Ø«Ù†ÙŠÙ†", "Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡", "Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡", "Ø§Ù„Ø®Ù…ÙŠØ³", "Ø§Ù„Ø¬Ù…Ø¹Ø©", "Ø§Ù„Ø³Ø¨Øª"];
                return days[new Date().getDay()];
            },

            formatTime(minutes) {
                const hrs = Math.floor(minutes / 60);
                const mins = minutes % 60;
                return hrs > 0 ? `${hrs} Ø³Ø§Ø¹Ø© ${mins} Ø¯Ù‚ÙŠÙ‚Ø©` : `${mins} Ø¯Ù‚ÙŠÙ‚Ø©`;
            },

            generateId() {
                return Date.now().toString() + Math.random().toString(36).substr(2, 9);
            },

            validateChildData(childData) {
                const errors = [];
                
                if (!childData.name || childData.name.trim().length < 2) {
                    errors.push("Ø§Ø³Ù… Ø§Ù„Ø·ÙÙ„ ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ Ø­Ø±ÙÙŠÙ†");
                }
                
                if (childData.birthDate) {
                    const birthDate = new Date(childData.birthDate);
                    const today = new Date();
                    if (birthDate > today) {
                        errors.push("ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø£Ù† ÙŠÙƒÙˆÙ† ÙÙŠ Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„");
                    }
                }
                
                if (childData.subjects.length === 0) {
                    errors.push("ÙŠØ¬Ø¨ Ø¥Ø¶Ø§ÙØ© Ù…Ø§Ø¯Ø© ÙˆØ§Ø­Ø¯Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„");
                }
                
                return errors;
            }
        };

        // Firebase Service Ù…Ø¹ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø£Ø®Ø·Ø§Ø¡ Ù…Ø­Ø³Ù†Ø©
        const firebaseService = {
            db: null,
            initialized: false,
            error: null,

            init() {
                try {
                    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªÙƒÙˆÙŠÙ† Firebase
                    if (!FIREBASE_CONFIG.apiKey || FIREBASE_CONFIG.projectId.includes('your-project')) {
                        this.error = "âš ï¸ ÙŠØ±Ø¬Ù‰ ØªÙƒÙˆÙŠÙ† Firebase Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø´Ø±ÙˆØ¹Ùƒ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ©";
                        console.warn(this.error);
                        return false;
                    }

                    const app = firebase.initializeApp(FIREBASE_CONFIG);
                    this.db = firebase.firestore();
                    
                    // ØªÙ…ÙƒÙŠÙ† ÙˆØ¶Ø¹ Ø¹Ø¯Ù… Ø§Ù„Ø§ØªØµØ§Ù„
                    this.db.enablePersistence().catch((err) => {
                        console.warn('ØªØ¹Ø·ÙŠÙ„ ÙˆØ¶Ø¹ Ø¹Ø¯Ù… Ø§Ù„Ø§ØªØµØ§Ù„:', err);
                    });

                    this.initialized = true;
                    console.log("âœ… ØªÙ… ØªÙ‡ÙŠØ¦Ø© Firebase Ø¨Ù†Ø¬Ø§Ø­");
                    return true;
                } catch (error) {
                    this.error = `âŒ ÙØ´Ù„ ØªÙ‡ÙŠØ¦Ø© Firebase: ${error.message}`;
                    console.error(this.error);
                    return false;
                }
            },

            async getCollection(collectionName) {
                if (!this.initialized) {
                    console.warn("Firebase ØºÙŠØ± Ù…Ù‡ÙŠØ¡");
                    return [];
                }
                try {
                    const snapshot = await this.db.collection(collectionName).get();
                    const data = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    console.log(`âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ ${data.length} Ù…Ø³ØªÙ†Ø¯ Ù…Ù† ${collectionName}`);
                    return data;
                } catch (error) {
                    console.error(`âŒ Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ ${collectionName}:`, error);
                    throw error;
                }
            },

            async saveDocument(collectionName, document) {
                if (!this.initialized) {
                    console.warn("Firebase ØºÙŠØ± Ù…Ù‡ÙŠØ¡");
                    return null;
                }
                try {
                    let docId;
                    if (document.id && document.id.length > 10) {
                        await this.db.collection(collectionName).doc(document.id).set(document, { merge: true });
                        docId = document.id;
                        console.log(`âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø³ØªÙ†Ø¯ ${docId} ÙÙŠ ${collectionName}`);
                    } else {
                        const docRef = await this.db.collection(collectionName).add(document);
                        docId = docRef.id;
                        console.log(`âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø³ØªÙ†Ø¯ Ø¬Ø¯ÙŠØ¯ ${docId} ÙÙŠ ${collectionName}`);
                    }
                    return docId;
                } catch (error) {
                    console.error(`âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­ÙØ¸ ÙÙŠ ${collectionName}:`, error);
                    throw error;
                }
            },

            async deleteDocument(collectionName, docId) {
                if (!this.initialized) {
                    console.warn("Firebase ØºÙŠØ± Ù…Ù‡ÙŠØ¡");
                    return false;
                }
                try {
                    await this.db.collection(collectionName).doc(docId).delete();
                    console.log(`âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªÙ†Ø¯ ${docId} Ù…Ù† ${collectionName}`);
                    return true;
                } catch (error) {
                    console.error(`âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­Ø°Ù Ù…Ù† ${collectionName}:`, error);
                    throw error;
                }
            }
        };

        // Ù†Ø¸Ø§Ù… Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø§ØªØµØ§Ù„
        const ConnectionManager = {
            isOnline: navigator.onLine,
            retryCount: 0,
            maxRetries: 3,

            init() {
                window.addEventListener('online', () => {
                    this.isOnline = true;
                    console.log('âœ… Ø§Ù„Ø§ØªØµØ§Ù„ Ø¹Ø§Ø¯');
                    this.retryConnection();
                });

                window.addEventListener('offline', () => {
                    this.isOnline = false;
                    console.log('âŒ ÙÙ‚Ø¯Ø§Ù† Ø§Ù„Ø§ØªØµØ§Ù„');
                });

                setInterval(() => {
                    if (!this.isOnline && this.retryCount < this.maxRetries) {
                        this.retryConnection();
                    }
                }, 5000);
            },

            async retryConnection() {
                if (!this.isOnline) return;
                
                try {
                    this.retryCount++;
                    console.log(`ğŸ”„ Ù…Ø­Ø§ÙˆÙ„Ø© Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø§ØªØµØ§Ù„ (${this.retryCount}/${this.maxRetries})`);
                    
                    await this.testFirebaseConnection();
                    this.retryCount = 0;
                    console.log('âœ… Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø§ØªØµØ§Ù„ Ù†Ø§Ø¬Ø­Ø©');
                } catch (error) {
                    console.error(`âŒ ÙØ´Ù„ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø§ØªØµØ§Ù„: ${error.message}`);
                }
            },

            async testFirebaseConnection() {
                if (!firebaseService.initialized) return false;
                
                try {
                    const testRef = firebaseService.db.collection('connection_test').doc('ping');
                    await testRef.set({
                        timestamp: new Date().toISOString(),
                        status: 'testing'
                    });
                    return true;
                } catch (error) {
                    throw new Error(`ÙØ´Ù„ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„: ${error.message}`);
                }
            }
        };

        // Ù…ÙƒÙˆÙ† Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„
        function ConnectionStatus({ firebaseService }) {
            const [connectionInfo, setConnectionInfo] = useState({
                status: 'checking',
                lastSync: null
            });

            useEffect(() => {
                const checkConnection = async () => {
                    if (firebaseService.initialized) {
                        try {
                            await ConnectionManager.testFirebaseConnection();
                            setConnectionInfo({
                                status: 'connected',
                                lastSync: new Date()
                            });
                        } catch (error) {
                            setConnectionInfo({
                                status: 'disconnected',
                                lastSync: new Date()
                            });
                        }
                    } else {
                        setConnectionInfo({
                            status: 'disconnected',
                            lastSync: null
                        });
                    }
                };

                if (firebaseService.initialized) {
                    checkConnection();
                    const interval = setInterval(checkConnection, 30000);
                    return () => clearInterval(interval);
                }
            }, [firebaseService.initialized]);

            const statusColors = {
                connected: 'bg-green-500',
                disconnected: 'bg-red-500',
                checking: 'bg-yellow-500'
            };

            if (!firebaseService.initialized && !firebaseService.error) return null;

            return (
                <div className="fixed bottom-4 left-4 z-40">
                    <div className={`p-3 rounded-lg shadow-lg text-white ${
                        statusColors[connectionInfo.status] || 'bg-gray-500'
                    }`}>
                        <div className="flex items-center gap-2">
                            <div className={`w-3 h-3 rounded-full ${
                                connectionInfo.status === 'connected' ? 'bg-green-400 animate-pulse' :
                                connectionInfo.status === 'disconnected' ? 'bg-red-400' : 'bg-yellow-400'
                            }`}></div>
                            <span className="text-sm font-bold">
                                {connectionInfo.status === 'connected' ? 'â˜ï¸ Ù…ØªØµÙ„' :
                                 connectionInfo.status === 'disconnected' ? 'âŒ ØºÙŠØ± Ù…ØªØµÙ„' : 'ğŸ”„ Ø¬Ø§Ø±ÙŠ Ø§Ù„ÙØ­Øµ'}
                            </span>
                        </div>
                        {firebaseService.error && (
                            <div className="text-xs mt-1 max-w-xs">
                                {firebaseService.error}
                            </div>
                        )}
                        {connectionInfo.lastSync && (
                            <div className="text-xs mt-1 opacity-80">
                                Ø¢Ø®Ø± Ù…Ø­Ø§ÙˆÙ„Ø©: {connectionInfo.lastSync.toLocaleTimeString('ar-EG')}
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        // Main App Component
        const { useState, useEffect, useCallback, useMemo } = React;

        function App() {
            const [appState, setAppState] = useState({
                step: 0,
                children: [],
                currentChildIndex: 0,
                activeTab: "Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©",
                darkMode: false,
                useFirebase: false,
                loading: false
            });

            const [newChild, setNewChild] = useState({
                name: "",
                birthDate: "",
                focusLevel: "Ù…ØªÙˆØ³Ø·",
                wakeTime: "05:30",
                sleepTime: "20:30",
                subjects: [],
                exams: [],
                weeklySchedule: Object.fromEntries(DAYS_OF_WEEK.map(day => [day, []])),
                goals: [],
                stars: 0,
                completed: [],
                achievements: [],
                studyTime: 0,
                avatar: "ğŸ‘¦",
                createdAt: new Date().toISOString()
            });

            const [rewards, setRewards] = useState(DEFAULT_REWARDS);
            const [notification, setNotification] = useState({ show: false, message: "", type: "" });
            const [studyTimer, setStudyTimer] = useState({ active: false, startTime: null, currentSubject: null });
            const [dailyPlan, setDailyPlan] = useState([]);

            // Initialize Firebase
            useEffect(() => {
                const initFirebase = async () => {
                    setAppState(prev => ({ ...prev, loading: true }));
                    
                    if (firebaseService.init()) {
                        setAppState(prev => ({ ...prev, useFirebase: true }));
                        showNotification("âœ… ØªÙ… Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³Ø­Ø§Ø¨ÙŠØ©", "success");
                        
                        try {
                            const [childrenData, rewardsData] = await Promise.all([
                                firebaseService.getCollection('children'),
                                firebaseService.getCollection('rewards')
                            ]);
                            
                            if (childrenData.length > 0) {
                                setAppState(prev => ({ ...prev, children: childrenData }));
                            }
                            
                            if (rewardsData.length > 0) {
                                setRewards(rewardsData);
                            }
                        } catch (error) {
                            console.error("Error loading data:", error);
                            showNotification("âš ï¸ ØªÙ… Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ù…Ù† Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ", "info");
                            loadFromLocalStorage();
                        }
                    } else {
                        loadFromLocalStorage();
                        showNotification("ğŸ“± ÙŠØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ", "info");
                    }
                    
                    setAppState(prev => ({ ...prev, loading: false }));
                };

                initFirebase();
                ConnectionManager.init();
            }, []);

            // Ø¨Ø§Ù‚ÙŠ Ø¯ÙˆØ§Ù„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚...
            const loadFromLocalStorage = useCallback(() => {
                try {
                    const storedChildren = localStorage.getItem("childrenData");
                    const storedRewards = localStorage.getItem("rewardsData");
                    const storedDarkMode = localStorage.getItem("darkMode");
                    
                    if (storedChildren) setAppState(prev => ({ ...prev, children: JSON.parse(storedChildren) }));
                    if (storedRewards) setRewards(JSON.parse(storedRewards));
                    if (storedDarkMode) setAppState(prev => ({ ...prev, darkMode: JSON.parse(storedDarkMode) }));
                } catch (error) {
                    console.error("Error loading from localStorage:", error);
                }
            }, []);

            const saveToLocalStorage = useCallback(() => {
                try {
                    localStorage.setItem("childrenData", JSON.stringify(appState.children));
                    localStorage.setItem("rewardsData", JSON.stringify(rewards));
                    localStorage.setItem("darkMode", JSON.stringify(appState.darkMode));
                } catch (error) {
                    console.error("Error saving to localStorage:", error);
                }
            }, [appState.children, rewards, appState.darkMode]);

            // Auto-save
            useEffect(() => {
                if (appState.children.length > 0 || rewards.length > 0) {
                    saveToLocalStorage();
                    
                    if (appState.useFirebase && firebaseService.initialized) {
                        appState.children.forEach(child => {
                            firebaseService.saveDocument('children', child).catch(error => {
                                console.error("Failed to sync child:", error);
                            });
                        });
                        rewards.forEach(reward => {
                            firebaseService.saveDocument('rewards', reward).catch(error => {
                                console.error("Failed to sync reward:", error);
                            });
                        });
                    }
                }
            }, [appState.children, rewards, appState.darkMode, appState.useFirebase, saveToLocalStorage]);

            const showNotification = useCallback((message, type = "info") => {
                setNotification({ show: true, message, type });
                setTimeout(() => setNotification({ show: false, message: "", type: "" }), 4000);
            }, []);

            // ... Ø¨Ø§Ù‚ÙŠ Ø¯ÙˆØ§Ù„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ØªØ¨Ù‚Ù‰ ÙƒÙ…Ø§ Ù‡ÙŠ

            return (
                <div className={`min-h-screen transition-colors duration-300 ${appState.darkMode ? 'dark-mode' : 'bg-gradient-to-br from-blue-50 to-purple-50'}`}>
                    <ConnectionStatus firebaseService={firebaseService} />
                    
                    <div className="max-w-7xl mx-auto p-4 container-padding">
                        {/* Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ÙŠØ¨Ù‚Ù‰ ÙƒÙ…Ø§ Ù‡Ùˆ */}
                        <div className="text-center">
                            <h1 className="text-4xl font-bold text-white">Ù†Ø¬Ù… Ø§Ù„ØªØ±ÙƒÙŠØ² â­</h1>
                            <p className="text-white opacity-80">Ù…Ù†ØµØ© ØªØ¹Ù„ÙŠÙ…ÙŠØ© Ù…ØªÙƒØ§Ù…Ù„Ø©</p>
                        </div>
                    </div>
                </div>
            );
        }

        // Initialize App
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
